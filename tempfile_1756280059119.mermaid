graph TD
    A[用户输入] --> B{操作类型}
    B -->|图像插入| C[insert_images.py]
    B -->|文本检索| D[search_images.py]
    
    C --> E[Chinese-CLIP模型]
    E --> F[特征向量(512D)]
    F --> G[PostgreSQL]
    G --> H[pgvector存储]
    H --> I[HNSW索引构建]
    
    D --> J[文本预处理]
    J --> K[Chinese-CLIP模型]
    K --> L[文本向量(512D)]
    L --> M[pgvector相似度计算]
    M --> N[相似图像结果]
    N --> O[结果排序与过滤]
    
    P[设备管理] --> Q{CUDA可用?}
    Q -->|是| R[GPU加速]
    Q -->|否| S{MPS可用?}
    S -->|是| T[Apple Silicon加速]
    S -->|否| U[CPU计算]
    
    E <--> P
    K <--> P
    G <--> V[数据库连接池]
    V <--> W[环境变量配置]
    
    style A fill:#FFE4B5,stroke:#333
    style O fill:#98FB98,stroke:#333
    style I fill:#87CEEB,stroke:#333
    style P fill:#FFB6C1,stroke:#333
